---
title: åŠ¨æ‰‹åšï¼šè´­ç‰©è½¦ ç­”æ¡ˆ
description: ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•è‡ªå·±å®Œæˆè´­ç‰©è½¦åŠŸèƒ½ã€‚
tableOfContents: false
---
<Aside>
å¦‚æœä½ æ‹¥æœ‰ä¸€å®šçš„è‡ªå­¦èƒ½åŠ›ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ [å‰ç«¯è¯¾ç¨‹ GitHub](https://github.com/JunxuanB/full-stack-tutorial-frontend) ä¸­æ‰¾åˆ°å¯¹åº”çš„ä»£ç ã€‚  

å¦‚æœä½ å–œæ¬¢è¿™ä¸ªè¯¾ç¨‹ï¼Œæ¬¢è¿ç»™ [è¿™ä¸ªè¯¾ç¨‹](https://github.com/JunxuanB/Junxuan-Bao-Personal-Website) åŠ ä¸€é¢—æ˜Ÿæ˜Ÿâ­ï¸ï¼Œè¿™å°†æ˜¯å¯¹æˆ‘æœ€å¤§çš„é¼“åŠ±ï¼
</Aside>

### å‡†å¤‡å·¥ä½œ
1. ä½¿ç”¨ `npm install decimal.js` å®‰è£… `decimal.js`ã€‚
1. åœ¨ `src/pages` ç›®å½•ä¸‹æ–°å»º `Cart.tsx` æ–‡ä»¶ï¼Œä½¿ç”¨ `rafce` å¿«é€Ÿç”Ÿæˆä¸€ä¸ªå‡½æ•°ç»„ä»¶ï¼ˆé¡µé¢ï¼‰ã€‚
2. åœ¨ `src/main.tsx` ä¸­å¼•å…¥ `Cart` ç»„ä»¶å¹¶æ³¨å†Œè·¯ç”±ã€‚
```tsx
import Cart from "./pages/cart";

createRoot(document.getElementById('root')!).render(
    <BrowserRouter>
        <Routes>
            <Route path="/cart" element={<Cart />} />
            { /* ... å…¶ä»–è·¯ç”± */ }
        </Routes>
    </BrowserRouter>
);
```
3. åœ¨ `src/pages/HelloWorld.tsx` ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œè·³è½¬åˆ° `/cart`ã€‚
```tsx
<button onClick={() => navigate('/cart')}>è´­ç‰©è½¦</button>
```

### å®šä¹‰å˜é‡
æ¥ä¸‹æ¥ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨ `Cart.tsx` ä¸­çš„ `Cart` å‡½æ•°ç»„ä»¶ä¸­è¿›è¡Œã€‚
1. å¼•å…¥éœ€è¦ç”¨çš„ `hook`ã€‚ä¹‹æ‰€ä»¥éœ€è¦è¿™ä¸€æ­¥æ˜¯å› ä¸º `antd` ä¸­æœ‰çš„ç»„ä»¶æ˜¯éœ€è¦å•ç‹¬é€šè¿‡ä¸€äº›ä»£ç å¼•å…¥çš„ï¼Œä¾‹å¦‚ `message` å’Œ `Typography`ã€‚
```tsx
const { Title, Text } = Typography;
const [messageApi, contextHolder] = message.useMessage();
```
2. å®šä¹‰æ•°æ®ç»“æ„ã€‚
```tsx
type Product = {
    id: number,
    name: string,
    price: number,
    discount: number,
    stock: number,
    image: string,
    realPrice: number
}
```
3. å®šä¹‰å•†å“å’Œè´­ç‰©è½¦çš„åˆ—è¡¨
```tsx
const [products, setProducts] = useState<Product[]>([]);

const [cart, setCart] = useState<
    {
        id: number,
        quantity: number
    }[]
>([]);
```
4. è·å–æ•°æ®
```tsx
useEffect(() => {
    myAPI.get('products.json')
        .then(response => {
            const newProducts = response.data.products as Product[];
            newProducts.forEach(product => {
                product.realPrice = new Decimal(product.price).minus(product.discount).toDecimalPlaces(2).toNumber();

            });
            setProducts(newProducts);
        });
}, []);
```

### å¸®åŠ©å‡½æ•°
1. æˆ‘ä»¬éœ€è¦ä¸€ä¸ª `total()` å‡½æ•°æ¥è®¡ç®—è´­ç‰©è½¦ä¸­çš„æ€»ä»·ã€‚
```tsx
const total = () => {
    let sum = new Decimal(0);
    cart.forEach(item => {
        const product = products.find(product => product.id === item.id);
        if (product) {
            sum = sum.plus(new Decimal(product.realPrice).times(item.quantity));
        }
    });
    return sum.toDecimalPlaces(2).toNumber();
}
```
2. è¿˜éœ€è¦ä¸€ä¸ª `updateCard(id, quantity)` å‡½æ•°æ¥æ›´æ–°è´­ç‰©è½¦ä¸­çš„å•†å“æ•°é‡ã€‚å…¶ä¸­ `quantity` è¡¨ç¤ºçš„æ˜¯å¢åŠ çš„æ•°é‡ã€‚åœ¨æ’°å†™è¿‡ç¨‹ä¸­è¿˜éœ€è¦æ³¨æ„ä¿®æ”¹åº“å­˜ï¼
```tsx
const updateCart = (id: number, quantity: number) => {
    const product = products.find(product => product.id === id);
    if (!product || product.stock < quantity) {
        return;
    }
    let newCart = [...cart];
    let found = false;
    newCart.forEach(item => {
        if (item.id === id) {
            item.quantity += quantity;
            found = true;
            if (item.quantity <= 0) {
                newCart = newCart.filter(item => item.id !== id);
            }
        }
    });
    if (!found && quantity > 0) {
        newCart.push({ id, quantity });
    }
    setCart(newCart);
    const updateProducts = [...products];
    updateProducts.forEach(product => {
        if (product.id === id) {
            product.stock -= quantity;
        }
    });
    setProducts(updateProducts);
}
```

### é¡µé¢
1. é¦–å…ˆè®©æˆ‘ä»¬åˆ¶ä½œä¸€ä¸ªæ¡†æ¶ã€‚
```tsx
<Card>
    {contextHolder} { /* å‚è€ƒ antd æ–‡æ¡£åŠ å…¥ç”¨äºå±•ç¤º message çš„ä»£ç  */ }
    <Row>
        <Col span={16}>
            <Title level={3} style={{ marginTop: 0 }}>æ°´æœå•†åŸ ğŸ</Title>
            <Flex gap={5} wrap>
                { /* å•†å“åˆ—è¡¨ */ }
            </Flex>
        </Col>
        <Col span={8}>
            <Card title="è´­ç‰©è½¦">
                <Flex gap={5} vertical>
                    { /* è´­ç‰©è½¦åˆ—è¡¨ */ }
                    <Title level={5}>æ€»ä»·ï¼š${total()}</Title>
                    { /* ç»“ç®—æŒ‰é’® æ³¨æ„è§‚å¯Ÿ onClick çš„å†™æ³• */ }
                    <Button type="primary" onClick={() => { messageApi.success('å·²ç»“ç®—'); setCart([]) }}>ç»“ç®—</Button>
                </Flex>
            </Card>
        </Col>
    </Row>
</Card>
```
2. å•†å“åˆ—è¡¨
```tsx
{products.map(product => (
    <Card key={product.id}>
        <Flex gap={1} vertical>
            <Title level={5} style={{ marginTop: -10 }}>
                <Tag color="cyan">#{product.id}</Tag>
                {product.name}
            </Title>
            <Text delete={product.discount > 0}>å•ä»·ï¼š${product.price}</Text>
            {product.discount > 0 && <Text mark>æŠ˜åä»·ï¼š${product.realPrice}</Text>}
            <Text type="secondary">åº“å­˜ï¼š{product.stock}</Text>
            <Image
                width={100}
                src={product.image}
            />
            <Button style={{ marginTop: 10 }} onClick={() => updateCart(product.id, 1)} disabled={product.stock <= 0}>åŠ å…¥è´­ç‰©è½¦</Button>
        </Flex>
    </Card>
))}
```
3. è´­ç‰©è½¦åˆ—è¡¨
```tsx
{cart.map(item => (
    <Card key={item.id} size="small" style={{ marginBottom: 10 }}>
        <DeleteOutlined style={{ marginRight: 10, color: 'red' }} onClick={() => updateCart(item.id, -item.quantity)} />
        {products.find(product => product.id === item.id)?.name} - ${products.find(product => product.id === item.id)?.realPrice} |
        æ•°é‡ï¼š<MinusCircleOutlined onClick={() => updateCart(item.id, -1)} /> {item.quantity} <PlusCircleOutlined onClick={() => updateCart(item.id, +1)} />
    </Card>
))}
```

### å®Œæ•´ä»£ç 
<Blur isEnglish={false} client:visible>
```tsx
import { Card, Col, Flex, Row, Typography, Image, Tag, Button, message } from "antd"
import { useEffect, useState } from "react";
import { myAPI } from "../axios";
import { DeleteOutlined, MinusCircleOutlined, PlusCircleOutlined } from "@ant-design/icons";
import Decimal from 'decimal.js';

const Cart = () => {
    const { Title, Text } = Typography;
    const [messageApi, contextHolder] = message.useMessage();

    type Product = {
        id: number,
        name: string,
        price: number,
        discount: number,
        stock: number,
        image: string,
        realPrice: number
    }

    const [products, setProducts] = useState<Product[]>([]);

    const [cart, setCart] = useState<
        {
            id: number,
            quantity: number
        }[]
    >([]);

    useEffect(() => {
        myAPI.get('products.json')
            .then(response => {
                const newProducts = response.data.products as Product[];
                newProducts.forEach(product => {
                    product.realPrice = new Decimal(product.price).minus(product.discount).toDecimalPlaces(2).toNumber();

                });
                setProducts(newProducts);
            });
    }, []);

    const total = () => {
        let sum = new Decimal(0);
        cart.forEach(item => {
            const product = products.find(product => product.id === item.id);
            if (product) {
                sum = sum.plus(new Decimal(product.realPrice).times(item.quantity));
            }
        });
        return sum.toDecimalPlaces(2).toNumber();
    }

    const updateCart = (id: number, quantity: number) => {
        const product = products.find(product => product.id === id);
        if (!product || product.stock < quantity) {
            return;
        }
        let newCart = [...cart];
        let found = false;
        newCart.forEach(item => {
            if (item.id === id) {
                item.quantity += quantity;
                found = true;
                if (item.quantity <= 0) {
                    newCart = newCart.filter(item => item.id !== id);
                }
            }
        });
        if (!found && quantity > 0) {
            newCart.push({ id, quantity });
        }
        setCart(newCart);
        const updateProducts = [...products];
        updateProducts.forEach(product => {
            if (product.id === id) {
                product.stock -= quantity;
            }
        });
        setProducts(updateProducts);
    }

    return (
        <Card>
            {contextHolder}
            <Row>
                <Col span={16}>
                    <Title level={3} style={{ marginTop: 0 }}>æ°´æœå•†åŸ ğŸ</Title>
                    <Flex gap={5} wrap>
                        {products.map(product => (
                            <Card key={product.id}>
                                <Flex gap={1} vertical>
                                    <Title level={5} style={{ marginTop: -10 }}>
                                        <Tag color="cyan">#{product.id}</Tag>
                                        {product.name}
                                    </Title>
                                    <Text delete={product.discount > 0}>å•ä»·ï¼š${product.price}</Text>
                                    {product.discount > 0 && <Text mark>æŠ˜åä»·ï¼š${product.realPrice}</Text>}
                                    <Text type="secondary">åº“å­˜ï¼š{product.stock}</Text>
                                    <Image
                                        width={100}
                                        src={product.image}
                                    />
                                    <Button style={{ marginTop: 10 }} onClick={() => updateCart(product.id, 1)} disabled={product.stock <= 0}>åŠ å…¥è´­ç‰©è½¦</Button>
                                </Flex>
                            </Card>
                        ))}
                    </Flex>
                </Col>
                <Col span={8}>
                    <Card title="è´­ç‰©è½¦">
                        <Flex gap={5} vertical>
                            {cart.map(item => (
                                <Card key={item.id} size="small" style={{ marginBottom: 10 }}>
                                    <DeleteOutlined style={{ marginRight: 10, color: 'red' }} onClick={() => updateCart(item.id, -item.quantity)} />
                                    {products.find(product => product.id === item.id)?.name} - ${products.find(product => product.id === item.id)?.realPrice} |
                                    æ•°é‡ï¼š<MinusCircleOutlined onClick={() => updateCart(item.id, -1)} /> {item.quantity} <PlusCircleOutlined onClick={() => updateCart(item.id, +1)} />
                                </Card>
                            ))}
                            <Title level={5}>æ€»ä»·ï¼š${total()}</Title>
                            <Button type="primary" onClick={() => { messageApi.success('å·²ç»“ç®—'); setCart([]) }}>ç»“ç®—</Button>
                        </Flex>
                    </Card>
                </Col>
            </Row>
        </Card>
    )
}

export default Cart
```
</Blur>

<Aside type="tip" title="ğŸ‰ æ­å–œä½ ğŸ‰ ">
æ­å–œä½ æˆåŠŸå®Œæˆäº†è´­ç‰©è½¦åŠŸèƒ½ï¼è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å‰ç«¯æŠ€æœ¯çš„ä¸€ä¸ªæ€»ç»“ã€‚å¦‚æœä½ èƒ½æˆåŠŸå®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆä½ å·²ç»æŒæ¡äº†å‰ç«¯å¼€å‘çš„åŸºæœ¬æŠ€èƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›å…¥åç«¯å¼€å‘çš„å­¦ä¹ ã€‚  

åœ¨è¿›å…¥åç«¯å¼€å‘ä¹‹å‰ï¼Œä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹æœ¬å¼ æ°çš„ æœªæ¥ éƒ¨åˆ†ï¼Œäº†è§£ä¸€äº›å‰ç«¯çš„æœªæ¥å‘å±•æ–¹å‘å’Œå…¶ä»–ä½ å¯ä»¥å­¦ä¹ çš„å†…å®¹ã€‚  

å†æ¬¡æé†’ï¼Œä½ å¯ä»¥åœ¨ [å‰ç«¯è¯¾ç¨‹ GitHub](https://github.com/JunxuanB/full-stack-tutorial-frontend) ä¸­æ‰¾åˆ°å¯¹åº”çš„ä»£ç ã€‚
</Aside>
<Aside type="tip" title="å¦‚æœä½ å–œæ¬¢è¿™ä¸ªè¯¾ç¨‹..">
å¦‚æœä½ å–œæ¬¢è¿™ä¸ªè¯¾ç¨‹ï¼Œæ¬¢è¿åœ¨ Github ä¸Šä¸º [æˆ‘çš„ç½‘ç«™](https://github.com/JunxuanB/Junxuan-Bao-Personal-Website) ç‚¹ä¸€ä¸‹å³ä¸Šè§’çš„ `â­ï¸ Star`ï¼Œè¿™å°†æ˜¯å¯¹æˆ‘æœ€å¤§çš„é¼“åŠ±ï¼  

ä½ ä¹Ÿå¯ä»¥é€šè¿‡ [issue](https://github.com/JunxuanB/Junxuan-Bao-Personal-Website/issues) æå‡ºä½ çš„æ„è§ä¸å»ºè®®ï¼Œå¸®åŠ©æˆ‘æ”¹è¿›è¿™ä¸ªè¯¾ç¨‹ã€‚
</Aside>